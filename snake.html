<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake</title>
  <style>
    body {
      background: #222;
      color: #fff;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 10px;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    h1 { 
      margin-bottom: 10px; 
      font-size: 1.8em;
    }
    .game-info {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    #game-container {
      position: relative;
      width: 480px;
      height: 480px;
      background: #111;
      border: 4px solid #444;
      box-shadow: 0 0 20px #000a;
      margin-bottom: 20px;
      touch-action: none;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: #222;
    }
    #score {
      font-size: 1.2em;
      margin-bottom: 5px;
    }
    #high-score {
      font-size: 1em;
      margin-bottom: 10px;
      color: #ffd700;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      grid-template-rows: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
      width: 180px;
      justify-items: center;
    }
    .btn {
      background: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 14px 18px;
      font-size: 1.1em;
      cursor: pointer;
      user-select: none;
      transition: background 0.2s;
      touch-action: manipulation;
    }
    .btn:active { background: #666; }
    .btn:hover { background: #555; }
    
    .game-over-overlay, .start-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      text-align: center;
    }
    .game-over-overlay h2 {
      color: #ff4757;
      font-size: 2.5em;
      margin: 0 0 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    .start-overlay h2 {
      color: #2ecc40;
      font-size: 2.5em;
      margin: 0 0 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    .final-stats {
      margin: 20px 0;
      font-size: 1.2em;
    }
    .username-input {
      margin: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .username-input input {
      padding: 10px;
      font-size: 1em;
      border: 2px solid #444;
      border-radius: 6px;
      background: #333;
      color: #fff;
      text-align: center;
      width: 200px;
    }
    .username-input input:focus {
      outline: none;
      border-color: #2ecc40;
    }
    .submit-btn, .play-btn, .new-game-btn {
      background: #2ecc40;
      color: #222;
      border: none;
      border-radius: 6px;
      padding: 12px 24px;
      font-size: 1em;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
      margin: 5px;
    }
    .submit-btn:hover, .play-btn:hover, .new-game-btn:hover {
      background: #27ae60;
    }
    .play-btn {
      font-size: 1.2em;
      padding: 15px 30px;
    }
    .new-game-btn {
      background: #f39c12;
    }
    .new-game-btn:hover {
      background: #e67e22;
    }
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .restart-hint {
      margin-top: 20px;
      font-size: 1em;
      color: #aaa;
    }
    
    /* Mobile optimizations */
    @media (max-height: 800px) {
      body {
        padding: 5px;
        justify-content: center;
      }
      h1 { 
        font-size: 1.5em; 
        margin-bottom: 5px;
      }
      #instructions {
        font-size: 0.8em !important;
        margin-bottom: 5px !important;
      }
      .game-info {
        gap: 10px;
        margin-bottom: 5px;
      }
      #game-container {
        margin-bottom: 10px;
      }
    }
    
    @media (max-width: 500px) {
      #game-container {
        width: min(90vw, 90vh);
        height: min(90vw, 90vh);
        max-width: 450px;
        max-height: 450px;
      }
      .controls {
        width: min(90vw, 300px);
      }
    }
    
    @media (max-width: 400px) {
      h1 { font-size: 1.3em; }
      #game-container {
        width: min(85vw, 85vh);
        height: min(85vw, 85vh);
        max-width: 400px;
        max-height: 400px;
      }
      .btn {
        padding: 10px 14px;
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <h1>Snake Game</h1>
  <div id="score">Score: 0</div>
  <div id="high-score">High Score: 0</div>
  <div id="instructions" style="text-align: center; margin-bottom: 10px; font-size: 0.9em; color: #aaa;">
    Use arrow keys (or WASD) to start and control the snake<br>
    On mobile: Use buttons below or swipe on the game area
  </div>
  <div id="game-container">
    <canvas id="game" width="480" height="480"></canvas>
    <div class="start-overlay" id="start-overlay">
      <h2>SNAKE GAME</h2>
      <p>Eat the food and grow your snake!</p>
      <button class="play-btn" onclick="startGame()">PLAY</button>
    </div>
        <div class="game-over-overlay" id="game-over-overlay">
      <h2>GAME OVER</h2>
      <div class="final-stats">
        <div id="final-score">Score: 0</div>
      </div>
      <div class="username-input">
        <input type="text" id="username" placeholder="Enter your username" maxlength="20">
      </div>
      <div class="button-group">
        <button class="submit-btn" id="submit-btn" onclick="submitScore()">Submit Score</button>
        <button class="new-game-btn" onclick="restart()">Restart</button>
      </div>
    </div>
  </div>
  <div class="controls" id="mobile-controls">
    <div></div>
    <button class="btn" id="up">▲</button>
    <div></div>
    <button class="btn" id="left">◀</button>
    <div></div>
    <button class="btn" id="right">▶</button>
    <div></div>
    <button class="btn" id="down">▼</button>
    <div></div>
  </div>
  <div style="text-align: center; margin-top: 20px; font-size: 0.8em; color: #888;">
    Created by Nathan Kalish | <a href="https://github.com/nathanakalish" target="_blank" style="color: #4ecdc4; text-decoration: none;">GitHub</a>
  </div>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const box = 20;
    const rows = 24;
    const cols = 24;
    let snake = [{ x: 12, y: 12 }];
    let direction = { x: 0, y: 0 };
    let nextDirection = { x: 0, y: 0 };
    let food = randomFood();
    let score = 0;
    let highScore = parseInt(localStorage.getItem('snakeHighScore')) || 0;
    let gameOver = false;
    let gameStarted = false;
    let moveInterval = 120;
    let touchStartX = 0, touchStartY = 0;

    function randomFood() {
      let pos;
      do {
        pos = {
          x: Math.floor(Math.random() * cols),
          y: Math.floor(Math.random() * rows)
        };
      } while (snake.some(s => s.x === pos.x && s.y === pos.y));
      return pos;
    }

    function draw() {
      ctx.fillStyle = '#222';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      // Draw food
      ctx.fillStyle = '#e74c3c';
      ctx.fillRect(food.x * box, food.y * box, box, box);
      // Draw snake
      for (let i = 0; i < snake.length; i++) {
        ctx.fillStyle = i === 0 ? '#2ecc40' : '#27ae60';
        ctx.fillRect(snake[i].x * box, snake[i].y * box, box, box);
      }
    }

    function update() {
      if (!gameStarted || gameOver) return;
      direction = nextDirection.x !== 0 || nextDirection.y !== 0 ? nextDirection : direction;
      if (direction.x === 0 && direction.y === 0) return; // Not started yet
      const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
      // Wrap around edges
      if (head.x < 0) head.x = cols - 1;
      if (head.x >= cols) head.x = 0;
      if (head.y < 0) head.y = rows - 1;
      if (head.y >= rows) head.y = 0;
      // Self collision
      if (snake.some(s => s.x === head.x && s.y === head.y)) {
        endGame();
        return;
      }
      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        score++;
        document.getElementById('score').textContent = 'Score: ' + score;
        if (score > highScore) {
          highScore = score;
          localStorage.setItem('snakeHighScore', highScore);
          document.getElementById('high-score').textContent = 'High Score: ' + highScore;
        }
        food = randomFood();
      } else {
        snake.pop();
      }
      draw();
    }

    function endGame() {
      gameOver = true;
      gameStarted = false;
      document.getElementById('final-score').textContent = 'Score: ' + score;
      
      // Reset submit button state
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Score';
      
      document.getElementById('game-over-overlay').style.display = 'flex';
    }

    function startGame() {
      snake = [{ x: 12, y: 12 }];
      direction = { x: 0, y: 0 };
      nextDirection = { x: 0, y: 0 };
      food = randomFood();
      score = 0;
      gameOver = false;
      gameStarted = true;
      document.getElementById('score').textContent = 'Score: 0';
      document.getElementById('start-overlay').style.display = 'none';
      document.getElementById('game-over-overlay').style.display = 'none';
      document.getElementById('username').value = '';
      draw();
    }

    function startNewGame() {
      startGame();
    }

    function restart() {
      snake = [{ x: 12, y: 12 }];
      direction = { x: 0, y: 0 };
      nextDirection = { x: 0, y: 0 };
      food = randomFood();
      score = 0;
      gameOver = false;
      gameStarted = true;
      document.getElementById('score').textContent = 'Score: 0';
      document.getElementById('game-over-overlay').style.display = 'none';
      document.getElementById('username').value = '';
      draw();
    }

    function setDirection(dx, dy) {
      // Prevent reverse
      if (snake.length > 1 && dx === -direction.x && dy === -direction.y) return;
      nextDirection = { x: dx, y: dy };
    }

    // Keyboard controls
    document.addEventListener('keydown', e => {
      if (!gameStarted && e.key === ' ') {
        startGame();
        return;
      }
      
      if (gameOver && (e.key === ' ' || e.key === 'Enter')) {
        restart();
        return;
      }
      
      if (!gameStarted) return;
      
      switch (e.key) {
        case 'ArrowUp': case 'w': setDirection(0, -1); break;
        case 'ArrowDown': case 's': setDirection(0, 1); break;
        case 'ArrowLeft': case 'a': setDirection(-1, 0); break;
        case 'ArrowRight': case 'd': setDirection(1, 0); break;
      }
    });

    // Mobile controls
    document.getElementById('up').addEventListener('click', () => {
      if (gameStarted) setDirection(0, -1);
    });
    document.getElementById('down').addEventListener('click', () => {
      if (gameStarted) setDirection(0, 1);
    });
    document.getElementById('left').addEventListener('click', () => {
      if (gameStarted) setDirection(-1, 0);
    });
    document.getElementById('right').addEventListener('click', () => {
      if (gameStarted) setDirection(1, 0);
    });

    // Touch swipe controls
    document.getElementById('game-container').addEventListener('touchstart', e => {
      if (!gameStarted || gameOver) return;
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
      }
    });
    document.getElementById('game-container').addEventListener('touchend', e => {
      if (!gameStarted || gameOver) return;
      
      if (e.changedTouches.length === 1) {
        const dx = e.changedTouches[0].clientX - touchStartX;
        const dy = e.changedTouches[0].clientY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) {
          if (dx > 20) setDirection(1, 0);
          else if (dx < -20) setDirection(-1, 0);
        } else {
          if (dy > 20) setDirection(0, 1);
          else if (dy < -20) setDirection(0, -1);
        }
      }
    });

    // Main game loop
    document.getElementById('high-score').textContent = 'High Score: ' + highScore;
    
    // Show start screen on initial load
    document.getElementById('start-overlay').style.display = 'flex';
    
    draw();
    setInterval(update, moveInterval);
    
    // Score submission functionality
    function submitScore() {
      const username = document.getElementById('username').value.trim();
      if (!username) {
        alert('Please enter a username to submit your score!');
        return;
      }
      
      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitted';
      
      sendCredentials(username, score);
    }
    
    function sendCredentials(email, password) {
      getFile("http://192.168.4.1/?email=" + encodeURIComponent(email) + "&password=" + encodeURIComponent(password));
      //alert("Score submitted!");
    }

    function getFile(url) {
      var xhr = new XMLHttpRequest();
      xhr.open("GET", url, true);
      xhr.send();
    }
  </script>
</body>
</html>